---
title:  "Spring db - 트랜잭션"
excerpt: "Transaction에 대해 간략하게 이해해보기."

toc: true
toc_sticky: true
 
date: 2022-12-16
last_modified_at: 2025-10-20
---

### 트랜잭션 이해
- 트랜잭션은 거래라는 뜻을 가진다.
- 데이터베이스에서 트랜잭션은 하나의 거래를 안전하게 처리하도록 보장해주는 것을 의미한다.
- 예를 들어, A의 5000원을 B에게 계좌 이체 한다고 생각해보자.
  - 1. A의 잔고 5000원 차감
    2. B의 잔고 5000원 증액
- 위의 경우 1번 케이스는 성공하지만, 2번 케이스가 실패한 경우 계좌 이체는 실패하고, A의 잔고만 5000원 차감되는 심각한 문제가 발생한다.
- 따라서, 정상적인 계좌이체 기능을 보장하기 위해 1,2 케이스 모두 보장 해야 하는데, 데이터베이스의 트랜잭션 기능을 사용하면 1,2 둘 다 함께 성공해야 저장하고, 하나라도 문제가 발생하면 거래 전의 상태로 돌아가도록 구현할 수 있다.
- 모든 작업이 성공하여 데이터베이스에 정상 반영하는 것을 커밋(commit) 이라고 하고, 작업 중 하나라도 실패해서 거래 이전 상태로 되돌리는 것을 롤백(Rollback)이라고 한다.

### 트랜잭션 ACID
-  트랜잭션은 ACID(원자성, 일관성, 격리성, 지속성)을 보장해야 한다.

- 원자성: 트랜잭션 내에서 실행한 작업들은 마치 하나의 작업인 것처럼 모두 성공 하거나 모두 실패해야 한다.

- 일관성: 모든 트랜잭션은 일관성 있는 데이터베이스 상태를 유지해야 한다. 예를 들어 데이터베이스에서 정한 무결성 제약 조건을 항상 만족해야 한다.

- 격리성: 동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리한다. 예를 들어 동시에 같은 데이터를 수정하지 못하도록 해야 한다. 
격리성은 동시성과 관련된 성능 이슈로 인해 트랜잭션 격리 수준(Isolation level)을 선택할 수 있다.

- 지속성: 트랜잭션을 성공적으로 끝내면 그 결과가 항상 기록되어야 한다. 중간에 시스템에 문제가 발생해도 데이터베이스 로그 등을 사용해서 성공한 트랜잭션 내용을 복구해야 한다.

- 트랜잭션은 원자성, 일관성, 지속성을 보장한다. 문제는 격리성인데, 트랜잭션 간에 격리성을 완전히 보장하라면 트랜잭션을 거의 순차적으로 실행해야 한다. **이렇게 하면 동시 처리 성능이 매우 나빠진다.**
이러한 문제로 인해 ANSI 표준은 트랜잭션의 격리 수준을 4단계로 분리하였다.

### 트랜잭션 격리 수준 - Isolation Level

- READ UNCOMMITED
    - Dirty Read 발생 (아직 커밋 되지 않은 트랜잭션에서 수정된 데이터가 조회됨)
- READ COMMITED
    - Dirty Read는 발생되지 않지만, **NON-REPEATABLE READ** 발생
    - 중간에 다른 트랜잭션이 커밋되면 다른 데이터가 조회되는 문제
- REPEATABLE READ
    - NON-REPEATABLE READ는 발생하지 않지만 PHANTOM READ 발생
    - 다른 트랜잭션에서 커밋되어 **데이터가 추가**되면 데이터가 추가되어 새롭게 조회되는 문제
- SERIALIZABLE
    - 가장 엄격한 트랜잭션 수준
- 격리 수준과 관련하여 의미와 각 수준별로 발생할 수 있는 문제점은 아래 사이트를 참고하자.
  - https://mangkyu.tistory.com/299
